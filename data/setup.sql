DROP TABLE posts;
DROP TABLE threads;
DROP TABLE sessions;
DROP TABLE users;

CREATE DATABASE IF NOT EXISTS chitchatdb;

CREATE TABLE IF NOT EXISTS users
(
  id SERIAL PRIMARY KEY,
  uuid UUID NOT NULL UNIQUE,
  name STRING(255),
  email STRING(255) NOT NULL UNIQUE,
  password STRING(255) NOT NULL,
  created_at TIMESTAMP NOT NULL
);

CREATE TABLE IF NOT EXISTS sessions
(
  id SERIAL PRIMARY KEY,
  uuid STRING(64) NOT NULL UNIQUE,
  email STRING(255),
  user_id SERIAL NOT NULL REFERENCES users(id),
  created_at TIMESTAMP NOT NULL,
  INDEX (user_id)
);

CREATE TABLE IF NOT EXISTS threads
(
  id SERIAL PRIMARY KEY,
  uuid STRING(64) NOT NULL UNIQUE,
  topic STRING,
  user_id SERIAL NOT NULL REFERENCES users(id),
  created_at TIMESTAMP NOT NULL,
  INDEX (user_id)
);

CREATE TABLE IF NOT EXISTS posts
(
  id SERIAL PRIMARY KEY,
  uuid STRING(64) NOT NULL UNIQUE,
  body STRING,
  user_id SERIAL NOT NULL REFERENCES users(id),
  thread_id SERIAL NOT NULL REFERENCES threads(id),
  created_at TIMESTAMP NOT NULL,
  INDEX (user_id),
  INDEX (thread_id)
);